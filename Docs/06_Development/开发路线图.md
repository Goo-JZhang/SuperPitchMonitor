# SuperPitchMonitor 开发路线图

## 1. 项目阶段规划

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         开发时间线 (约16周)                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Phase 1: 基础架构 (Week 1-4)                                               │
│  ████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░   │
│       │                                                                     │
│       ├── Week 1: 项目初始化与 JUCE 集成                                    │
│       │   ├── 创建 CMake 构建系统                                           │
│       │   ├── 配置 Android 项目结构                                         │
│       │   ├── 集成 JUCE 模块                                                │
│       │   └── 实现基础 AudioEngine 框架                                     │
│       │                                                                     │
│       ├── Week 2: 音频输入系统                                              │
│       │   ├── AAudio 后端实现                                               │
│       │   ├── OpenSL ES 回退实现                                            │
│       │   ├── 音频权限管理                                                  │
│       │   └── 缓冲区管理                                                    │
│       │                                                                     │
│       ├── Week 3: 基础频谱分析                                              │
│       │   ├── FFT 实现                                                      │
│       │   ├── 窗函数处理                                                    │
│       │   ├── 频谱可视化基础                                                │
│       │   └── 性能优化                                                      │
│       │                                                                     │
│       └── Week 4: 基础 UI 框架                                              │
│           ├── 主界面布局                                                    │
│           ├── 频谱显示组件                                                  │
│           ├── 基础主题系统                                                  │
│           └── 设置面板框架                                                  │
│                                                                             │
│  Phase 2: 音高检测 (Week 5-8)                                               │
│  ░░░░░░░░░░░░░░░░████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░   │
│       │                                                                     │
│       ├── Week 5: 峰值检测与单音识别                                        │
│       │   ├── 频谱峰值检测算法                                              │
│       │   ├── 基频估算                                                      │
│       │   ├── 谐波验证                                                      │
│       │   └── 基础音高显示                                                  │
│       │                                                                     │
│       ├── Week 6: YIN 算法实现                                              │
│       │   ├── 差分函数计算                                                  │
│       │   ├── CMNDF 归一化                                                  │
│       │   ├── 基频精修                                                      │
│       │   └── 与频域方法融合                                                │
│       │                                                                     │
│       ├── Week 7: 多音高检测 (基础)                                         │
│       │   ├── 谐波聚类算法                                                  │
│       │   ├── 多候选音筛选                                                  │
│       │   ├── 音高卡片组件                                                  │
│       │   └── 置信度计算                                                    │
│       │                                                                     │
│       └── Week 8: 时序跟踪与优化                                            │
│           ├── 音高跟踪器                                                    │
│           ├── 时序平滑                                                      │
│           ├── 快速音符识别                                                  │
│           └── 延迟优化                                                      │
│                                                                             │
│  Phase 3: 高级功能 (Week 9-12)                                              │
│  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░████████████████░░░░░░░░░░░░░░░░░░░░░░░░░   │
│       │                                                                     │
│       ├── Week 9: 多分辨率频谱分析                                          │
│       │   ├── 多 FFT 大小支持                                               │
│       │   ├── 频率相关分辨率                                                │
│       │   ├── 瞬时频率估计                                                  │
│       │   └── 增强频谱显示                                                  │
│       │                                                                     │
│       ├── Week 10: NMF 多音分离                                             │
│       │   ├── 频谱模板库                                                    │
│       │   ├── NMF 分解算法                                                  │
│       │   ├── 迭代优化                                                      │
│       │   └── 开关控制                                                      │
│       │                                                                     │
│       ├── Week 11: 调音器功能                                               │
│       │   ├── 调音器界面                                                    │
│       │   ├── 音分偏差计算                                                  │
│       │   ├── 指针动画                                                      │
│       │   └── 参考频率调节                                                  │
│       │                                                                     │
│       └── Week 12: 高级可视化                                               │
│           ├── 色度频谱                                                      │
│           ├── 频谱图 (Spectrogram)                                          │
│           ├── 3D 频谱 (可选)                                                │
│           └── 自定义配色                                                    │
│                                                                             │
│  Phase 4: Android 优化 (Week 13-14)                                         │
│  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░████████░░░░░░░░░░░░░░░░░   │
│       │                                                                     │
│       ├── Week 13: 平台适配                                                 │
│       │   ├── 多分辨率图标                                                  │
│       │   ├── 屏幕适配                                                      │
│       │   ├── 权限处理优化                                                  │
│       │   └── 生命周期管理                                                  │
│       │                                                                     │
│       └── Week 14: 性能优化                                                 │
│           ├── SIMD 优化                                                     │
│           ├── 内存池实现                                                    │
│           ├── 自适应质量                                                    │
│           └── 电池优化                                                      │
│                                                                             │
│  Phase 5: 测试与发布 (Week 15-16)                                           │
│  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░████████████████   │
│       │                                                                     │
│       ├── Week 15: 测试                                                     │
│       │   ├── 单元测试                                                      │
│       │   ├── 设备兼容性测试                                                │
│       │   ├── 性能测试                                                      │
│       │   └── 用户测试                                                      │
│       │                                                                     │
│       └── Week 16: 发布准备                                                 │
│           ├── 文档完善                                                      │
│           ├── 应用商店素材                                                  │
│           ├── 隐私政策                                                      │
│           └── 构建发布                                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 详细任务清单

### Phase 1: 基础架构 (Week 1-4)

#### Week 1: 项目初始化
- [ ] 创建项目目录结构
- [ ] 编写 CMakeLists.txt
- [ ] 配置 Android Gradle 构建
- [ ] 集成 JUCE 模块
- [ ] 创建基础 MainComponent
- [ ] 设置版本控制

**交付物**: 可编译运行的基础应用框架

#### Week 2: 音频输入系统
- [ ] 实现 AudioEngine 类
- [ ] 集成 AAudio 支持
- [ ] 实现 OpenSL ES 回退
- [ ] 音频权限申请流程
- [ ] 音频缓冲区 FIFO 设计
- [ ] 基础音频设备管理

**交付物**: 能捕获音频输入并显示音量的应用

#### Week 3: 基础频谱分析
- [ ] 集成 JUCE FFT
- [ ] 实现窗函数应用
- [ ] 频谱数据计算
- [ ] SpectrumDisplay 组件
- [ ] 基础频谱绘制
- [ ] 性能基准测试

**交付物**: 实时频谱显示功能

#### Week 4: 基础 UI 框架
- [ ] 主界面布局设计
- [ ] 深色主题实现
- [ ] 状态栏组件
- [ ] 设置面板框架
- [ ] 响应式布局基础
- [ ] 基础动画系统

**交付物**: 完整的 UI 框架

---

### Phase 2: 音高检测 (Week 5-8)

#### Week 5: 峰值检测与单音识别
- [ ] 频谱峰值检测算法
- [ ] 抛物线插值精修
- [ ] 基频估算
- [ ] 谐波验证逻辑
- [ ] PitchCard 组件
- [ ] 音高显示功能

**交付物**: 单音高检测与显示

#### Week 6: YIN 算法实现
- [ ] 差分函数 (DF) 计算
- [ ] CMNDF 归一化
- [ ] 最佳周期搜索
- [ ] 时域精修实现
- [ ] 频域/时域融合
- [ ] 精度对比测试

**交付物**: 更精确的单音检测

#### Week 7: 多音高检测 (基础)
- [ ] 谐波关系分析
- [ ] 谐波聚类算法
- [ ] 多候选音筛选
- [ ] 置信度计算
- [ ] 多音高显示布局
- [ ] 音高跟踪器

**交付物**: 基础多音高检测 (2-4个音)

#### Week 8: 时序跟踪与优化
- [ ] 音高跟踪算法
- [ ] 时序平滑处理
- [ ] 快速音符检测优化
- [ ] Onset/Offset 检测
- [ ] 延迟测量与优化
- [ ] 快速演奏测试

**交付物**: 快速节奏下稳定的音高检测

---

### Phase 3: 高级功能 (Week 9-12)

#### Week 9: 多分辨率频谱分析
- [ ] 多 FFT 大小支持
- [ ] 频率相关分辨率选择
- [ ] 频谱合并逻辑
- [ ] 瞬时频率估计
- [ ] 增强频谱显示
- [ ] 性能优化

**交付物**: 高质量频谱分析

#### Week 10: NMF 多音分离
- [ ] 频谱模板库构建
- [ ] NMF 算法实现
- [ ] 迭代优化策略
- [ ] 复杂度控制
- [ ] 开关配置
- [ ] 效果评估

**交付物**: 复杂和声场景下的多音分离

#### Week 11: 调音器功能
- [ ] TunerDisplay 组件
- [ ] 音分偏差计算
- [ ] 指针动画
- [ ] 参考频率调节 (A4=440Hz)
- [ ] 音准状态显示
- [ ] 调音辅助功能

**交付物**: 专业调音器功能

#### Week 12: 高级可视化
- [ ] 色度频谱 (Chroma)
- [ ] 频谱图 (Spectrogram)
- [ ] 瀑布图效果
- [ ] 自定义配色方案
- [ ] 显示设置面板
- [ ] 可视化性能优化

**交付物**: 丰富的可视化选项

---

### Phase 4: Android 优化 (Week 13-14)

#### Week 13: 平台适配
- [ ] 多分辨率图标
- [ ] 屏幕尺寸适配
- [ ] 横竖屏支持
- [ ] 权限流程优化
- [ ] 生命周期处理
- [ ] 后台行为控制

**交付物**: 适配各类 Android 设备

#### Week 14: 性能优化
- [ ] SIMD 加速 (NEON)
- [ ] 内存池实现
- [ ] 自适应质量系统
- [ ] 电池优化
- [ ] 发热控制
- [ ] 性能监控

**交付物**: 流畅省电的应用

---

### Phase 5: 测试与发布 (Week 15-16)

#### Week 15: 测试
- [ ] 单元测试编写
- [ ] 算法准确性测试
- [ ] 设备兼容性测试 (10+ 设备)
- [ ] 性能基准测试
- [ ] 用户测试
- [ ] Bug 修复

**交付物**: 稳定可靠的版本

#### Week 16: 发布准备
- [ ] 用户文档编写
- [ ] 应用商店截图
- [ ] 应用描述
- [ ] 隐私政策
- [ ] 签名配置
- [ ] 发布构建

**交付物**: 可发布的 APK/AAB

---

## 3. 里程碑检查点

### Milestone 1: 基础框架完成 (Week 2)
- [ ] 项目能成功编译
- [ ] 能在 Android 设备运行
- [ ] 能捕获音频输入
- [ ] 显示音量指示

### Milestone 2: 频谱显示完成 (Week 4)
- [ ] 实时频谱显示
- [ ] 流畅的 60fps
- [ ] 基础 UI 完整
- [ ] 设置面板可用

### Milestone 3: 音高检测完成 (Week 8)
- [ ] 单音检测准确率 > 90%
- [ ] 多音检测 (2-4音) 准确率 > 75%
- [ ] 快速音符响应 < 50ms
- [ ] 稳定的音高跟踪

### Milestone 4: 功能完整 (Week 12)
- [ ] 多分辨率频谱
- [ ] NMF 多音分离 (可选)
- [ ] 调音器功能
- [ ] 丰富可视化

### Milestone 5: 发布就绪 (Week 16)
- [ ] 多设备兼容
- [ ] 性能达标
- [ ] 用户文档完整
- [ ] 应用商店准备就绪

---

## 4. 风险评估与应对

| 风险 | 可能性 | 影响 | 应对策略 |
|-----|-------|------|---------|
| NMF 算法性能不足 | 中 | 高 | 准备简化方案，提供开关控制 |
| Android 设备延迟差异大 | 高 | 中 | 设备数据库，延迟校准功能 |
| 多音检测准确率不理想 | 中 | 高 | 持续优化，设定合理期望值 |
| 电池消耗过快 | 中 | 高 | 自适应质量，省电模式 |
| 低端设备性能不足 | 高 | 中 | 多档位性能配置 |

---

## 5. 资源需求

### 开发环境
- Android Studio Hedgehog 或更新
- CMake 3.22+
- NDK r25+
- JUCE 7.x

### 测试设备
| 设备类型 | 最低配置 | 推荐配置 |
|---------|---------|---------|
| 低端 | Android 7, 2GB RAM | Android 9, 3GB RAM |
| 中端 | Android 10, 4GB RAM | Android 12, 6GB RAM |
| 高端 | Android 12, 6GB RAM | Android 14, 8GB RAM |

### 测试音频素材
- 纯音测试信号 (各种频率)
- 乐器单音采样
- 和弦音频
- 快速音阶
- 真实音乐片段
