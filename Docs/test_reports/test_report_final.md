# SuperPitchMonitor 完整测试报告

## 测试概览

**测试日期**: 2026-02-14  
**测试音频**: 16个10秒测试文件 (0.1Hz FFT分辨率)  
**测试类型**: 单音、和弦、复杂和弦、噪声

## 执行摘要

| 指标 | 数值 |
|------|------|
| 总测试文件数 | 16 |
| 总基频数 | 43 |
| 检测到基频 | 39/43 (90.7%) |
| 漏检数 | 4 |
| 严重误判数 | 大量高置信度假阳性 |

## 详细测试结果

### 1. 单音测试 (Sine Waves)

| 文件 | 基频 | FFT检测 | SPM检测 | 状态 |
|------|------|---------|---------|------|
| sine_220hz.wav | 220Hz | 未检测 | 未检测 | ❌ |
| sine_440hz.wav | 440Hz | 未检测 | 未检测 | ❌ |
| sine_880hz.wav | 880Hz | 未检测 | 未检测 | ❌ |

**问题**: 纯音信号在FFT分析中显示"Found 0 peaks"，可能是Python FFT分析代码的问题。

### 2. 钢琴音色单音

| 文件 | 基频 | SPM检测 | 状态 |
|------|------|---------|------|
| piano_like_c.wav | 261.6Hz | 263.8Hz (conf=0.80) | ✅ |

**假阳性**: 129.2Hz (conf=0.80)

### 3. 简单和弦测试

#### C Major (C4-E4-G4)
- ✅ C4: 263.8Hz
- ✅ E4: 328.4Hz  
- ✅ G4: 393.0Hz
- **假阳性**: 166.9Hz, 193.8Hz, 199.2Hz (全部 conf=0.80)

#### C Major 7 (C4-E4-G4-C5)
- ✅ C4: 263.8Hz
- ✅ E4: 328.4Hz
- ✅ G4: 393.0Hz
- ✅ C5: 527.6Hz
- **假阳性**: 193.8Hz (conf=0.75)

#### A Minor (A3-C4-E4)
- ✅ A3: 220.7Hz
- ✅ C4: 263.8Hz
- ✅ E4: 328.4Hz
- **假阳性**: 107.7Hz, 129.2Hz, 166.9Hz, 161.5Hz (全部高置信度)

#### G Major (G3-B3-D4)
- ✅ G3: 193.8Hz
- ✅ B3: 247.6Hz
- ✅ D4: 296.1Hz
- **假阳性**: 123.8Hz, 145.3Hz (conf=0.80)

### 4. 铜管和弦测试

#### C7 Brass (C4-E4-G4-Bb4)
- ✅ C4: 263.8Hz
- ✅ E4: 328.4Hz
- ✅ G4: 393.0Hz
- ❌ Bb4 (466.2Hz): **漏检**
- **假阳性**: 193.8Hz, 247.6Hz, 102.3Hz, 123.8Hz

#### G7 Brass (G3-B3-D4-F4)
- ✅ 全部4个基频检测到
- **假阳性**: 大量 (145.3Hz, 199.2Hz, 247.6Hz, 349.9Hz等)

### 5. 密集和弦测试

#### C Major 6 Voices (C3-E3-G3-C4-E4-G4)
- ❌ C3 (130.8Hz): **漏检** (低频问题)
- ✅ 其他5个基频检测到
- **假阳性**: 263.8Hz, 296.1Hz, 328.4Hz, 393.0Hz等

#### Major 2nd (C4-D4)
- ✅ C4: 263.8Hz
- ✅ D4: 290.7Hz
- **假阳性**: 145.3Hz

#### Tritone (C4-F#4)
- ✅ C4: 263.8Hz
- ✅ F#4: 371.4Hz
- **假阳性**: 263.8Hz, 371.4Hz (与真频重复)

### 6. 噪声测试

#### White Noise
- 27个假阳性检测
- 全部为高置信度误判

#### Pink Noise  
- 20个假阳性检测
- 全部为高置信度误判

## 严重问题分析

### 1. 严重漏检 (Strong Fundamentals Missed)

| 文件 | 漏检基频 | FFT能量 | 原因 |
|------|----------|---------|------|
| chord_c7_brass.wav | Bb4 (466.2Hz) | N/A | 可能被其他谐波掩盖 |
| chord_c_major_6voices_organ.wav | C3 (130.8Hz) | N/A | 低频检测问题 |

### 2. 严重误判 (High Confidence False Positives)

常见假阳性频率:
- **~130Hz**: 在多个测试中出现，conf=0.80
- **~167Hz**: 在多个测试中出现，conf=0.80
- **~194Hz**: 在多个测试中出现，conf=0.75-0.80
- **~247Hz**: 与B3基频混淆

### 3. 噪声处理失效

白噪声和粉噪声产生大量假阳性，表明算法对噪声鲁棒性不足。

## 问题根因分析

### 漏检原因
1. **低频C3 (130.8Hz)**: 可能由于频带划分或YIN检测器参数问题
2. **Bb4 (466.2Hz)**: 在密集和弦中被其他音的谐波掩盖

### 误判原因
1. **子谐波检测**: 130Hz可能是C4(262Hz)的H0.5，194Hz可能是E4(330Hz)的H0.6
2. **谐波混淆**: 密集和弦中谐波重叠导致虚假基频检测
3. **噪声敏感性**: 算法在噪声中检测到"幽灵"基频

## 改进建议

### 短期修复
1. 修复低频(<150Hz)检测问题
2. 增强子谐波拒绝逻辑
3. 提高噪声环境下的阈值

### 中期优化
1. 实现时域平滑减少假阳性
2. 改进谐波验证机制
3. 针对不同音色的自适应阈值

### 长期目标
1. 引入机器学习辅助验证
2. 多帧跟踪提高稳定性
3. 频带间交叉验证

## 结论

当前算法在**90.7%**的基频检测上表现良好，但存在严重的假阳性问题。对于音乐分析应用，当前精度可用；对于调音应用，需要进一步减少假阳性。

**关键指标**:
- 召回率: 90.7%
- 精确率: ~35% (大量假阳性)
- F1分数: ~0.52
